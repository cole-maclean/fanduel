LobbyConnection={get:function(){if(!this.$connection){this.$connection=FDConnection.available?new LobbyConnection.WebSocket():new LobbyConnection.AJAX()}return this.$connection},WebSocket:function(){this.$connection=FDConnection.get(FDConnection.URIS);this.$connection.connect()},AJAX:function(){},processResult:function(h,o,i){var a={};var j=[];var g=[];var l=[];var d={};if(Lobby.DEBUG){log("Received: %o",o)}if(o.lastUpdate!==undefined){LobbyConnection.lastUpdate=o.lastUpdate}if(o.lastRemoval!==undefined){LobbyConnection.lastRemoval=o.lastRemoval}var e=o.data;if(o.permissions){this.addReceivedPermissions(h,o.permissions)}var b=false,n={},f,m;if(o.remaining){b={};for(f=0;f<o.remaining.length;f++){b[o.remaining[f]]=true}}if(o.deletions){for(f=0;f<o.deletions.length;f++){n[o.deletions[f]]=true;h.removeQueuedAdditionById(o.deletions[f])}}var k=h.getAllItems().concat(h.getQueuedAdditions());for(f=0;f<k.length;f++){m=k[f],uniqueId=m.get("uniqueId");a[uniqueId]=m;if(b&&(!(b[uniqueId]))){g.push(m)}else{if(n[uniqueId]){g.push(m)}}}function c(q,p){function r(){if(q.get("entryFee")!=p.entryFee){return true}if(q.get("entriesData")!=p.entriesData){return true}if(q.get("entryURL")!=p.entryURL){return true}if(q.get("stack")!=p.stack){return true}if(q.get("startString")!=p.startString){return true}if(q.get("size")!=p.size){return true}return false}if(r()){l.push(p)}}if(o.additions){for(f=0;f<o.additions.length;f++){m=o.additions[f];if(!a[m.uniqueId]){if(m.flags.restricted){if(!LobbyConnection.requestPermissions(h,m)){continue}}j.push(m)}}}if(o.modifications){for(f=0;f<o.modifications.length;f++){m=o.modifications[f];if(!a[m.uniqueId]){continue}c(a[m.uniqueId],m)}}if(Lobby.DEBUG){log("   result: added(%o) modified(%o) removed(%o)",j,l,g)}if(j.length>0){h.queueAdditions(j)}for(f=0;f<g.length;f++){h.removeRawItem(g[f])}for(f=0;f<l.length;f++){h.updateRawItem(l[f])}},addReceivedPermissions:function(d,b){if(!b){return}var a=[];for(var c in b){LobbyConnection.permissionLookup[c]=b[c]?true:false;if((LobbyConnection.permissionLookup[c]!==false)&&LobbyConnection.permissionItems[c]){a.push(LobbyConnection.permissionItems[c])}}if(a.length){LobbyConnection.processResult(d,{additions:a})}},sendPermissionsRequest:function(e,a){var b=this;if(!a){a=Ajax.defaultQueue}function c(f){b.addReceivedPermissions(e,JSON.parse(f.data))}if(LobbyConnection.permissionQueue.length){var d=LobbyConnection.permissionQueue.join(",");LobbyConnection.permissionQueue.length=0;a.add([{type:"pg",serverhandler:"Lobby/getLobbyItemsPermissionJSON/"+d,clienthandler:c}])}},requestPermissions:function(b,a){var c=a.uniqueId;if(LobbyConnection.permissionLookup[c]===true){return true}else{if(LobbyConnection.permissionLookup[c]!==false){if(LobbyConnection.permissionQueue.indexOf(c)==-1){LobbyConnection.permissionQueue.push(c);LobbyConnection.permissionItems[c]=a}if(FDConnection.available){if(LobbyConnection.permTimeout){return false}else{LobbyConnection.permTimeout=setTimeout(function(){LobbyConnection.permTimeout=null;LobbyConnection.sendPermissionsRequest(b)},100)}}return false}}return false},permissionLookup:{},permissionItems:{},permissionQueue:[]};LobbyConnection.WebSocket.prototype={EVENT_LOBBY:"event/lobby",HOST:"ws://ws.fanduel.com:80/websocket",subscribe:function(b){var a=this.$connection;if(FDConnection.USE_AJAX_FALLBACK){a.register(FDConnection.EVENT_CONNECTION_RETRY_WARNING,function(){a.cancel();log("Lobby websocket connection: too many failed attempts to connect - reverting to ajax");FDConnection.available=false;LobbyConnection.$connection=false;LobbyConnection.get().subscribe(b)})}a.register(this.EVENT_LOBBY,function(c){LobbyConnection.processResult(b,c.data);Ajax.defaultQueue.send()});a.register(FDConnection.EVENT_CONNECTION_CONNECTED,function(){a.subscribe("lobby",{lastUpdate:LobbyConnection.lastUpdate,lastDeletion:LobbyConnection.lastRemoval})});if(LobbyConnection.initialData){LobbyConnection.addReceivedPermissions(b,LobbyConnection.initialData.permissions);b.setItems(LobbyConnection.initialData.additions);Ajax.defaultQueue.send()}}};LobbyConnection.AJAX.prototype={subscribe:function(f){var d=[];var h={};if(LobbyConnection.initialData){f.setItems(LobbyConnection.initialData.additions)}var c=60*60*4;var g=AutoUpdate.add(b,3,c);var e=true;var a=this;function b(j,k){if(LobbyConnection.PAUSED&&!k){return}function i(l){if(l.data==""){if(Lobby.DEBUG){log("Received: no data")}return}LobbyConnection.processResult(f,JSON.parse(l.data))}j.add([{type:"pg",serverhandler:"Lobby/showLobbyItemsJSON/"+LobbyConnection.lastUpdate+"/"+LobbyConnection.lastRemoval,clienthandler:i}]);LobbyConnection.sendPermissionsRequest(f,j);e=false}}};(function(){var a=this,c=false;var b=a.Lobby=new Backbone.Marionette.Application();$(document).ready(function(){if(c){return}c=true;b.PendingView=Backbone.Marionette.ItemView.extend({template:"#Lobby-Pending",tagName:"tr",className:"pending"});b.View=Backbone.Marionette.LazyCompositeView.extend({constructor:function(){Backbone.Marionette.LazyCompositeView.prototype.constructor.apply(this,arguments);this.allItems=new b.Item.Collection();this.additions=[];this.manualSyncTimeout=null;this.modelCache={};this.connection=LobbyConnection.get();this.attachLobbyEvents();this.ADDITIONS_QUEUE_TIMEOUT=1*60*1000},onShow:function(){Backbone.Marionette.LazyCompositeView.prototype.onShow.apply(this,arguments);this.contestLightbox=new ContestLightbox.View({isFromLobby:true,lobbyView:this});this.filterPanel=new b.Filter.attach(this.$el.parents(".lobby").find("[data-filter=true]").addBack(),_.bind(this.syncAdditions,this));this.nextGameTimer=new b.NextGameTimer(this);var d=this.$el.parents(".lobby").find("input.defaultSort");if(d&&d.val()){this.defaultSort=JSON.parse(d.val())}this.sorter=new b.Sort(this);this.connection.subscribe(this)},transitionAdd:function(d){d.$el.addClass("add");setTimeout(function(){d.$el.removeClass("add")},750)},transitionRemove:function(d){d.$el.attr("title","Contest unavailable.").addClass("removed").find("td, a").on("click",function(f){f.preventDefault();f.stopPropagation()}).end().find("a.button").addClass("disabled")},transitionChange:function(d){d.$el.addClass("changed");setTimeout(function(){d.$el.removeClass("changed")},750)},attachLobbyEvents:function(){this.listenTo(this.allItems,"add",this.addItem);this.listenTo(this.allItems,"remove",this.removeItem);this.listenTo(this.allItems,"reset",this.updateVisibleItems)},setItems:function(h){this.modelCache={};var i=[],m={},f=false,k=h.length;for(var j=0;j<k;j++){var n=h[j];if(n.flags&&n.flags.restricted){if(!LobbyConnection.requestPermissions(this,n)){continue}}i.push(n)}this.allItems.reset(i);var e=this.allItems.models,k=e.length,d=this.modelCache;for(var j=0;j<k;j++){var g=e[j],l=g.get("uniqueId");d[l]=g}this.nextGameTimer.update();this.updateEmptyView()},updateEmptyView:function(){if(this.collection.length>0){this.$el.parents(".lobby").removeClass("empty")}else{this.$el.parents(".lobby").addClass("empty")}},addItem:function(d){if(this.filterPanel.filter([d]).length){this.collection.add(d)}},removeItem:function(d){if(this.filterPanel.filter([d]).length){this.collection.remove(d)}},addRawItems:function(e){var g=this.allItems.models;var d=e.length;for(var f=0;f<d;f++){g.push(e[f])}this.allItems.reset(g)},getQueuedAdditions:function(){return this.additions},syncAdditions:function(){this.addRawItems(this.additions);this.additions=[];$(".lobby .items .updatesAvailable").removeClass("is-visible")},removeQueuedAdditionById:function(e){var d=_.find(this.additions,function(f){return f.get("uniqueId")===e});if(d){this.additions.splice(this.additions.indexOf(d),1)}},queueAdditions:function(e){var g=false,i=this.additions,j=this,f=$(".lobby .items .updatesAvailable"),h=f.hasClass("is-visible");var d=_.map(e,function(k){return new b.Item(k)});_.each(d,function(k){var l=k.get("uniqueId");j.removeQueuedAdditionById(l);j.modelCache[l]=k;i.push(k);g=g||j.filterPanel.filter([k]).length>0});if(g&&!h&&!j.manualSyncTimeout){j.manualSyncTimeout=setTimeout(function(){j.manualSyncTimeout=null;f.addClass("is-visible")},this.ADDITIONS_QUEUE_TIMEOUT)}},removeRawItem:function(d){this.allItems.remove(d);this.modelCache[d.get("uniqueId")]=null;this.removeQueuedAdditionById(d.get("uniqueId"))},updateRawItem:function(g){var d=this.modelCache[g.uniqueId];if(!d){return}var h={},f=false;for(var e in g){if(!g.hasOwnProperty(e)){continue}if(g[e]!=d.get(e)){h[e]=g[e];f=true}}if(f){d.set(h)}},getAllItems:function(){return this.allItems.models},getVisibleItems:function(){return this.collection.models},sort:function(d){this.collection.comparator=d;if(d){this.collection.sort()}this.clearManualSyncTimeout();this.syncAdditions()},setSort:function(d){this.collection.comparator=d},updateVisibleItems:function(){var d=this.filterPanel.filter(this.allItems.models);this.collection.reset(d);this.nextGameTimer.update();this.updateEmptyView();this.scrollToTop();this.clearManualSyncTimeout()},scrollToTop:function(){this.$el.find(this.viewport).scrollTop(0)},clearManualSyncTimeout:function(){if(this.manualSyncTimeout){clearTimeout(this.manualSyncTimeout);this.manualSyncTimeout=null}},template:"#Lobby-View",container:"table.items tbody",viewport:"div.inner",pendingView:b.PendingView,itemView:b.Item.View,templateHelpers:{hasHeight:function(){return this.height?true:false},getHeight:function(){return this.height}}});b.addRegions({main:"div.lobby div.items"});b.main.show(a.lobbyView=new b.View({collection:new b.Item.Collection()}));$(".lobby .items .updatesAvailable a").click(function(d){d.preventDefault();a.lobbyView.syncAdditions();a.lobbyView.updateVisibleItems()})})})();(function(f,c){var a=this;var e=["nba_official_tentpole"];var d=Backbone.Marionette.ItemView;var b=Backbone.Model.extend({defaults:{eligibleRosters:[],userEntryTotal:0,disabled:false,allowQuickfire:false},initialize:function(){this.setEligibleRosters();this.setUserEntryTotal();this.updateSize();this.updateEntryCount();this.updateFlags();this.updateTitle();this.listenTo(this,"change:size",this.updateSize);this.listenTo(this,"change:size",this.updateEntryCount);this.listenTo(this,"change:entriesData",this.updateEntryCount);this.listenTo(this,"change:flags",this.updateFlags);this.listenTo(this,"change:title",this.updateTitle);this.listenTo(this,"change:seatCode",this.enable)},setEligibleRosters:function(){this.set("eligibleRosters",FD.rosterData.getEligibleRosters(this.get("gameId")))},setUserEntryTotal:function(){this.set("userEntryTotal",FD.rosterData.getTotalEntriesCount(this.get("seatCode")||this.get("uniqueId")))},enable:function(){this.setUserEntryTotal();this.set("disabled",false)},updateSize:function(){this.attributes.size=parseInt(this.attributes.size)},updateEntryCount:function(){var g=size=this.get("size"),h=this.get("entriesData");this.set({entryCount:size==2?1.5:parseInt(h)},{silent:true})},updateFlags:function(){var h=this.get("flags");if(h.beginner){this.set({gameLevel:b.BEGINNER},{silent:true})}else{if(h.expert){this.set({gameLevel:b.EXPERT},{silent:true})}else{this.set({gameLevel:b.INTERMEDIATE},{silent:true})}}var g=c.intersection(c.keys(h),e).length>0;this.set({allowQuickfire:(this.get("eligibleRosters").length>0)&&!g})},updateTitle:function(){var g;if(+this.get("size")===2){g="H2H vs. "+this.get("entriesData")[0]}else{g=this.get("title")}this.set("sortTitle",this.get("sport")+" "+g)}});b.Collection=Backbone.Collection.extend({model:b});b.View=d.extend({template:"#Lobby-ItemView",tagName:"tr",className:"lobbyitem",render:function(){d.prototype.render.apply(this,arguments);var i=[],h=this.model.get("flags");for(var g in h){if(h.hasOwnProperty(g)){i.push(g)}}if(this.model.get("userEntryTotal")>0){i.push("lobby-already-entered");if(user.id===631653||user.id===324300){this.$el.find(".entry .icon").attr("style","color:orange")}}this.$el.addClass(i.join(" "))},initialize:function(){this.listenTo(this.model,"change",this.render)},templateHelpers:{headToHeadRegex:/^(MLB|NFL|NBA|NHL|CBB|CFB) Head-to-head */,getTitle:function(){if(+this.size===2){return this.title.replace(this.headToHeadRegex,"H2H ")}else{return this.title}},getSport:function(){return this.sport.toLowerCase()},getUpperSport:function(){return this.sport.toUpperCase()},getSportURL:function(){return"/images/lobby-icons/"+this.getSport()+".png"},getPrizes:function(){var g="";if(this.prizeSummary){g=this.prizeSummary;if((g.indexOf("(")!==-1)&&(g.indexOf(")")!==-1)){g=g.replace("(","<small>(");g=g.replace(")",")</small>")}}else{g=this.formatCash(this.prizes)}return g},getPrizeBreakdownClass:function(){var g="";if(this.prizeBreakdown){g+=" breakdown";if(this.prizeSummary){g+=" summary"}}return g},getSize:function(){if(this.size>999999){return"No cap"}else{return this.size}},getEntryFee:function(){return this.formatCash(this.entryFee)},formatCash:function(h){if(parseInt(h)!=h){var g="$"+formatDecimals(h,2)}else{var g=formatDollars(parseInt(h))}return g},getEntries:function(){var g=this.entriesData;if(!isNaN(g)){return g}else{return""}},getStack:function(){var g=this.stack||0,h=this.entriesData[0];if(g<2){return""}else{return'<span class="stack" '+(h?'title="'+h+" has "+g+' of these entries available"':"")+">(x"+g+")</span>"}},getEntryButton:function(){var g=this.allowQuickfire?' data-tab="quickfire"':"";return'<a class="button primary tiny" href="'+this.entryURL+'"'+g+">Enter</a>"},getMultiIndicator:function(){if(this.flags.multi){return"<div class='multi indicator' title='Multi-entry'>M</div>"}else{return""}},getGuaranteedIndicator:function(){if(this.flags.tournament){return"<div class='guaranteed indicator' title='Guaranteed prize pool'>G</div>"}else{return""}},getVsText:function(){var g=this.entriesData;if(isNaN(g)){return'<div class="user"><span class="versus"> vs. </span><a target="_blank" href="/users/'+g[0]+'"><span style="font-weight:bold;">'+g[0]+"</span></a></div>"}}}});b.BEGINNER=0;b.INTERMEDIATE=1;b.EXPERT=2;b.Collection=Backbone.Collection.extend({model:b});if(!("Lobby" in f)){f.Lobby={}}f.Lobby.Item=b})(window,_);Lobby.Comparator=new (function(){function c(e,d){if(e.get("flags").top==d.get("flags").top){return 0}return e.get("flags").top?-1:1}function a(e,d){if(e==d){return 0}return e<d?-1:1}function b(f,e,h,d,g){var i=c(f,e);if(i!=0){return d?-i:i}return(g?g:a)(f.get(h),e.get(h),h)}this.NONE=false;this.TITLE=function(e,d,f){return b(e,d,"sortTitle",f)};this.SIZE=function(e,d,f){return b(e,d,"size",f)};this.ENTRYFEE=function(e,d,f){return b(e,d,"entryFee",f)};this.CAP=function(e,d,f){return b(e,d,"cap",f)};this.PRIZES=function(e,d,f){return b(e,d,"prizes",f)};this.STARTTIME=function(e,d,f){return b(e,d,"startTime",f)};this.ENTRIES=function(e,d,f){return b(e,d,"entriesData",f,function(j,h){var k=j.push?1.5:parseInt(j);var i=h.push?1.5:parseInt(h);if(k==i){if(k==1.5){var g=j[0].toLowerCase().localeCompare(h[0].toLowerCase());return f?-g:g}return 0}return k>i?1:-1})};this.INVERT=function(d){if(!d.inverse){d.inverse=function(f,e){return -d(f,e,true)};d.inverse.inverse=d}return d.inverse}})();(function(){Lobby.Sort=function a(b){this.lobbyView=b;this.getInitialState();this.attachEvents()};_.extend(Lobby.Sort.prototype,Backbone.Events,{getSortFunction:function(){var b=this.order;if(b.length){var d=[];for(var c=0;c<b.length;c++){var e=Lobby.Comparator[b[c].type];if(!e){continue}if(b[c].desc){e=Lobby.Comparator.INVERT(e)}d.push(e)}return function(h,g){for(var i=0;i<d.length;i++){var f=d[i](h,g);if(f!=0){return f}}return 0}}else{return null}},apply:function(){this.lobbyView.sort(this.getSortFunction())},setSort:function(){this.lobbyView.setSort(this.getSortFunction())},attachEvents:function(){var b=this;this.lobbyView.$el.find("thead th").click(function(){b.onHeaderClick($(this))})},onHeaderClick:function(c){var d=null,b=this.order;if(!(Lobby.Comparator[d=this.findSortClass(c)])){c=c.prev();if(!(Lobby.Comparator[d=this.findSortClass(c)])){return}}this.selectHeader(d)},findSortClass:function(c){var b=c.attr("class");if(!b){return null}b=_.reduce(b.split(/ /),function(d,e){switch(e){case"asc":case"desc":return d;default:return e.toUpperCase()}},null);return b},selectHeader:function(e,f){if(!e){return}var d=null,b=this.order;if(typeof(e)=="string"){d=e.toUpperCase();e=this.lobbyView.$el.find("th."+e.toLowerCase())}if(this.current!==e&&this.current){this.current.removeClass("asc desc")}if(!d){d=this.findSortClass(e)}if(f==undefined&&b[0]&&b[0].type==d){b[0].desc=!b[0].desc}else{for(var c=0;c<b.length;c++){if(b[c].type==d){b.splice(c,1);break}}b.unshift({type:d,desc:f==undefined?true:f})}this.current=e;if(b[0].desc){this.current.removeClass("asc");this.current.addClass("desc")}else{ascending=true;this.current.removeClass("desc");this.current.addClass("asc")}this.apply();if(this.updateSort){Cookie.set("lobbySort",b,-1)}},getInitialState:function(){this.updateSort=true;var b=Cookie.get("lobbySort");if(b){this.order=b}else{if(this.lobbyView.defaultSort){this.order=this.lobbyView.defaultSort}}if(this.order&&this.order.unshift&&this.order[0]){this.selectHeader(this.order[0].type,this.order[0].desc);this.setSort()}else{this.order=[]}}})})();(function(m){var p="FD.lobby.filter.data";var q=1;var k=m.localStorage?{set:function(r,s){localStorage.setItem(r,JSON.stringify(s))},get:function(s,t){var r=localStorage.getItem(s);if(!r){return t}else{try{return JSON.parse(r)}catch(u){window.log("WARNING: Failed to unpack stored state: ",r);return t}}},remove:function(r){localStorage.removeItem(r)}}:{set:function(){},get:function(r,s){return s},remove:function(){}};function f(r){this.ranges=r||[]}f.prototype={binaryInsert:function(s){var v=this.ranges;if(v.length===0){v.push(s);return}var r=this.binaryFindLeft(s),t=v[r].index,u=s.index;if(t===u){v[r]=s}else{if(u<t){v.splice(r,0,s)}else{v.splice(r+1,0,s)}}},binaryFindLeft:function(u){var x=this.ranges,v=u.index,w=0,s=x.length-1;if(s===-1){return -1}while(s-w>1){var t=Math.floor((s+w)/2),r=x[t].index;if(r>v){s=t;continue}else{if(r<v){w=t;continue}}return t}return x[s].index<=v?s:w},set:function(u,w,s){var t=this.ranges,v=this.binaryFindLeft({index:u}),y=v!==-1?t[v].index:-1,x=this.test(u-1,false),z=this.binaryFindLeft({index:w+1}),r=z!==-1?t[z].state:false;if(y!==u){v++}if(z>=v){t.splice(v,z-v+1)}if(x!=s){this.binaryInsert({index:u,state:s})}if(r!=s){this.binaryInsert({index:w+1,state:r})}},setString:function(s,t){var r=f.toRange(s);t=t?true:false;this.set(r.start,r.end,t)},test:function(t,s){var r=this.binaryFindLeft({index:t});if(r===-1||this.ranges[r].index>t){return s}else{return this.ranges[r].state}},testRange:function(w,r,u){var v=this.binaryFindLeft({index:w}),s=this.binaryFindLeft({index:r}),t;if(v===-1||this.ranges[v].index>w){t=u}else{t=this.ranges[s].state}if(v===s){return t}else{return undefined}},getRange:function(){var r=this.ranges;if(r.length>2){window.log("WARNING: Fetching range from split Ranges - probably means you are mixing sliders and sets")}return{start:r.length<1?-1:r[0].index,end:r.length<1?-1:r[r.length-1].index-1}},pack:function(){return this.ranges},unpack:function(r){this.ranges=r}};f.LARGEST=2147483647;f.toRange=function(t){t=String(t);var v,r;var s=t.indexOf("-");if(s!==-1){v=t.substring(0,s);r=t.substring(s+1);v=v===""?0:parseInt(v,10);r=r===""?f.LARGEST:parseInt(r,10);if(isNaN(v)||isNaN(r)){window.log("WARNING: Invalid range specified: ",t)}return{start:v,end:r}}s=t.indexOf("+");if(s!==-1){v=t.substring(0,s);v=v===""?0:parseInt(v,10);if(isNaN(v)){window.log("WARNING: Invalid range specified: ",t)}return{start:v,end:f.LARGEST}}var u=parseInt(t,10);if(isNaN(u)){window.log("WARNING: Invalid range specified: ",t)}return{start:u,end:u}};function d(r){this.element=r;this.events={}}var b="fd.lobby.filter";d.get=function(r){return r.data(b)};d.create=function(s){var t=d.get(s);if(t){return t}var r=new d(s);s.data(b,r);return r};function h(r,t,s,u){this.checks=r;this.hide=t;this.element=s;this.filter=u;this.state=undefined;u.conditions.push(this)}h.prototype={check:function(){var s=this.element,t=this.filter;var u=_.every(this.checks,function(v){return v(s,t)});var r=u!==this.state;this.state=u;if(r&&this.hide){if(u){s.removeClass("filter-condition-hidden")}else{s.addClass("filter-condition-hidden")}}return u}};h.attach=function(u,w){var v=d.get(u);if(v){return v.condition}var r=d.create(u);var s=[],x=u.data("filterCondition").split(/,/),t=u.data("filterHide")?true:false;_.each(x,function(z){switch(z){case"visible":s.push(function(A,B){return A.is(":visible")});return}var y=h.attach.comparator(w,z,u);if(y){s.push(y)}});if(s.length){r.condition=new h(s,t,u,w);return r.condition}return null};h.attach.comparator=function(u,x,s){var r=x.indexOf("=");if(r==-1){window.log("WARNING: Unknown condition type ",x," in ",s);return false}var t=x.substring(0,r),w=x.substring(r-1,r),v=x.substring(r+1);if(w==="!"){return function(y,z){var A=z.types[t.substring(0,t.length-1)];if(A.conditionTest){return !A.conditionTest(v)}else{return !A.test(v)}}}else{return function(y,z){if(z.types[t].conditionTest){return z.types[t].conditionTest(v)}else{return z.types[t].test(v)}}}};function j(r,u,t){var v=r.parents("[data-filter-group]").find("[data-filter-persist]");var s=this.handler=function(){_.delay(function(){v.promise().done(function(){t.rebuild(true)})},500)};r.bind(u,s)}j.attach=function(t,u){var s=t.data("filterEvent").split(/,/),r=d.create(t);_.each(s,function(v){if(!r.events[v]){r.events[v]=new j(t,v,u)}})};function g(r){this.element=r;this.name=r.data("filterPersist")}g.prototype={pack:function(){return{display:this.element.css("display"),visible:this.element.css("visible"),height:this.element.css("height")}},unpack:function(r){this.element.css({display:r.display,visible:r.visible,height:r.height});this.element.trigger("fdStateUnpack")}};g.attach=function(s,t){var r=d.create(s);r.state=new g(s);t.persist.push(r.state)};function i(t,r,s){if(!s){return}this.type=s.types[t];this.element=r;this.filter=s;this.populateConditions();this.attachToFilter()}i.prototype={apply:function(){throw new Error("Unimplemented")},populateConditions:function(){var r=this.element,s=this.conditions=[];r.parents("[data-filter-condition]").each(function(){s.push(d.get($(this)).condition)})},attachToFilter:function(){this.type.components.push(this)},checkConditions:function(){this.active=_.every(this.conditions,function(r){return r.state});return this.active}};i.Checkbox=function(u,r,t){var s=this;this.value=r.val();i.call(this,u,r,t);r.bind("change",function(){if(s.active){s.type.setState(s.value,r.is(":checked"));t.rebuild(true)}})};i.Checkbox.prototype=_.extend(new i(),{apply:function(){this.type.setState(this.value,this.element.is(":checked"))},unpack:function(){this.element.prop("checked",this.type.test(this.value))},init:function(){this.apply()}});i.Radio=function(u,r,t){var s=this;this.value=r.val();this.state=r.data("filterState");this.element=r;if(this.state===undefined){this.state=true}i.call(this,u,r,t);if(r.is(":checked")){this.addCheckedClassToLabel()}r.bind("change",function(){if(s.active&&r.is(":checked")){s.addCheckedClassToLabel();s.type.setState(s.value,true);t.rebuild(true)}})};i.Radio.prototype=_.extend(new i(),{addCheckedClassToLabel:function(){this.element.parents("label").first().siblings("label.checked").toggleClass("checked");this.element.parents("label").first().addClass("checked")},apply:function(){if(this.element.is(":checked")){_.each(this.group,function(r){r.type.setState(r.value,!r.state)});this.type.setState(this.value,this.state)}},unpack:function(){if(this.unpacked){return}if(this.type.test(this.value)){this.element.prop("checked",this.state);this.unpacked=true;_.each(this.group,function(r){r.unpacked=true});this.addCheckedClassToLabel()}},init:function(){var t=this.group=[],r=this;var s='input[type=radio][name="'+this.element.prop("name")+'"]';this.element.parents("[data-filter=true]").find(s).each(function(){var u=d.get($(this));if(!u||!u.option||u.option===r||!(u.option instanceof i.Radio)){return}t.push(u.option)});if(this.element.is(":checked")){this.apply()}}});i.Text=function(w,t,v){var u=this,s=t.val();if(s.toLowerCase()===u.defaultValue.toLowerCase()){this.search=""}else{this.search=t.val()}t.parents("form").first().searchBox({activeClass:"active-os",inFocusClass:"infocus-os",disabledButtonClass:"disabled-os",explicitDefaultValue:this.defaultValue});function r(){if(u.active){var x=t.val();if(x.toLowerCase()==u.defaultValue.toLowerCase()){x=""}u.search=x;u.type.setText(u.search);v.rebuild(true)}}t.bind("keyup",_.debounce(r,500));i.call(this,w,t,v)};i.Text.prototype=_.extend(new i(),{defaultValue:"Search all contests...",apply:function(){this.type.setText(this.search)},unpack:function(){this.search=this.type.getText();if(this.search&&(this.search.toLowerCase()!==this.defaultValue.toLowerCase())){this.element.val(this.search);this.element.trigger("keyup")}},init:function(){this.apply()}});i.Hidden=function(t,r,s){var u=r.data("filterState");this.state=u?u:false;this.value=r.val();i.call(this,t,r,s)};i.Hidden.prototype=_.extend(new i(),{apply:function(){this.type.setState(this.value,this.state)},unpack:function(){}});i.RangeSlider=function(v,s,u){var t=this;var w=s.data("filterUpdate");if(w){w=s.parents("[data-filter=true]").find(w)}if(!w.length){w=false}if(s.prop("tagName")!="SELECT"){window.log("WARNING: Slider element should be a <select> tag, not: <",s.prop("tagName").toLowerCase(),">");return null}this.slider=new window.RangeSlider(s,function x(z,y){t.start=+z.value;t.end=+y.value;if(w){w.text(z.text+" - "+y.text)}},function r(z,y){t.start=+z.value;t.end=+y.value;if(w){w.text(z.text+" - "+y.text)}t.type.setRange(t.start,t.end);t.filter.rebuild(true)});i.call(this,v,s,u)};i.RangeSlider.prototype=_.extend(new i(),{apply:function(){this.type.setRange(0,this.start-1,false);this.type.setRange(this.end+1,f.LARGEST,false)},unpack:function(){var r=this.type.getRange();this.slider.setValues(r.start,r.end)}});i.jQRangeSlider=function(u,r,t){var s=this;if(r.prop("tagName")!="DIV"){window.log("WARNING: jQSlider element should be a <div> tag, not: <",r.prop("tagName").toLowerCase(),">");return null}this.slider=r.rangeSlider({arrows:false,bounds:s.minMax,defaultValues:s.minMax,formatter:function(v){return s.entryFeeMapping[v]},scales:[{next:function(v){return v+1},label:function(){return""}}],step:1}).bind("valuesChanged",function(w,v){s.start=s.rangeValueMapping[v.values.min];s.end=s.rangeValueMapping[v.values.max];s.type.setRange(s.start,s.end);s.filter.rebuild()}).bind("userValuesChanged",function(w,v){s.start=s.rangeValueMapping[v.values.min];s.end=s.rangeValueMapping[v.values.max];s.type.setRange(s.start,s.end);s.filter.rebuild(true)});i.call(this,u,r,t)};i.jQRangeSlider.prototype=_.extend(new i(),{entryFeeMapping:["Free","$1","$2","$5","$10","$25","$50","$109","$270","$535","$1K","$10K"],rangeValueMapping:[0,1,2,5,10,25,50,109,270,535,1000,10000],minMax:{min:0,max:11},apply:function(){this.type.setRange(0,this.start-1,false);this.type.setRange(this.end+1,f.LARGEST,false)},unpack:function(){var r=this.type.getRange();r.end=Math.min(this.rangeValueMapping[this.rangeValueMapping.length-1],r.end);this.slider.rangeSlider("values",this.rangeValueMapping.indexOf(r.start),this.rangeValueMapping.indexOf(r.end))},init:function(){this.slider.trigger("valuesChanged",{values:this.minMax})}});i.attach=function(t,u){var s=d.create(t);if(s.option){return s.option}var r=t.attr("type"),v=t.data("filterType");if(t.data("filterSlider")){s.option=new i.RangeSlider(v,t,u);return s.option}if(t.data("filterJqslider")){s.option=new i.jQRangeSlider(v,t,u);return s.option}switch(r){case"checkbox":s.option=new i.Checkbox(v,t,u);break;case"radio":s.option=new i.Radio(v,t,u);break;case"text":s.option=new i.Text(v,t,u);break;case"hidden":s.option=new i.Hidden(v,t,u);break;default:window.log("WARNING: Cannot attach FilterOption to node with type: ",r);return undefined}return s.option};function o(s,r){this.type=s;this.check=r;this.components=[]}o.prototype={setState:function(){window.log("WARNING: Setting state, unimplemented for ",this);return false},setRange:function(){window.log("WARNING: Setting range, unimplemented for ",this);return false},setText:function(){window.log("WARNING: Setting text, unimplemented for ",this);return false},getText:function(){window.log("WARNING: Getting text, unimplemented for ",this);return undefined},getRange:function(){window.log("WARNING: Getting range, unimplemented for ",this);return undefined},rebuild:function(){this.reset();_.each(this.components,function(r){if(r.checkConditions()){r.apply()}})}};o.Set=function n(t,s,u,r){o.call(this,t,r);this.def={values:s,def:u};this.reset()};o.Set.prototype=_.extend(new o(),{reset:function(){var t=this.lookup={},s=this.def.def,r=this.def.values;_.each(r,function(u){t[u]=s})},setState:function(s,r){if(this.lookup[s]!==r){this.lookup[s]=r}return true},getTestFunction:function(s){var t=this.lookup,r=this.type;return this.check?this.check(s,this):function(u){return t[u.get(r)]}},test:function(r){return this.lookup[r]?true:false},pack:function(){return this.lookup},unpack:function(s){var t=this.lookup;for(var r in s){if(s.hasOwnProperty(r)){if(t[r]===undefined){window.log("WARNING: Unknown value: ",r," when unpacking existing state for: ",this);return}}}_.extend(this.lookup,s);_.each(this.components,function(u){u.unpack()})}});o.Switch=function a(t,s,u,r){o.call(this,t,r);this.values=s;this.def=u;_.each(s,function(v){s[v]=true});this.reset()};o.Switch.prototype=_.extend(new o(),{reset:function(){this.selected=this.def},setState:function(s,r){if(!r){return false}this.selected=s;return true},getTestFunction:function(t){var s=s,r=this.type;return this.check?this.check(t,this):function(u){return u.get(r)===s}},test:function(r){return this.selected===r},pack:function(){return this.selected},unpack:function(r){if(!this.values[r]){window.log("WARNING: Failed to unpack filter option, invalid value: ",r);return}this.selected=r;_.each(this.components,function(s){s.unpack()})}});o.Range=function e(s,t,r){o.call(this,s,r);this.init=t;this.reset()};o.Range.prototype=_.extend(new o(),{reset:function(){this.ranges=new f();if(this.init){this.setState(this.init,true)}},setState:function(t,s){var r=f.toRange(t);this.setRange(r.start,r.end,s)},setRange:function(t,r,s){this.ranges.set(t,r,s);return true},getRange:function(){return this.ranges.getRange()},test:function(t){var s=f.toRange(t);var r=this.ranges.testRange(s.start,s.end);if(r!==undefined){return r}return false},getTestFunction:function(t){var r=this.ranges,s=this.type;return this.check?this.check(t,this):function(u){return r.test(u.get(s))}},pack:function(){return this.ranges.pack()},unpack:function(r){this.ranges.unpack(r);_.each(this.components,function(s){s.unpack()})}});o.TextSearch=function l(s,t,r){o.call(this,s,r);this.types=s.split(",");this.def=t?t.toLowerCase():"";this.reset()};o.TextSearch.prototype=_.extend(new o(),{reset:function(){this.search=this.def},setText:function(r){this.search=r?r:"";return true},getText:function(){return this.search},getTestFunction:function(t){var s=this.search,r=this.types;if(this.check){return this.check(t,this)}if(!s||s===""){return function(u){return true}}return function(u){return _.some(r,function(v){var w=u.get(v);return w?w.toLowerCase().indexOf(s)!==-1:false})}},test:function(s){var r=this.search;if(!r||r===""){return false}return s?s.toLowerCase().indexOf(r)!==-1:false},conditionTest:function(r){return r===this.search},pack:function(){return this.search},unpack:function(r){this.search=r;_.each(this.components,function(s){s.unpack()})}});function c(r,t,s,v,u){this.root=r;this.types=t;this.apply=s;this.conditions=v||[];this.persist=[];this.rebuild=_.debounce(_.bind(this.rebuildImmediate,this),150);this.attachInterface(r);this.attachAllNone(r)}c.clearFilters=function(){k.remove(p);k.remove("FD.lobby.filter")};c.prototype={attachInterface:function(r){var t=this,s=[];r=r||document;$(r).find("[data-filter=true]").andSelf().filter("[data-filter=true]").each(function(){$(this).find("[data-filter-condition]").each(function(){h.attach($(this),t)});$(this).find("[data-filter-event]").each(function(){j.attach($(this),t)});$(this).find("[data-filter-persist]").each(function(){g.attach($(this),t)});$(this).find("[data-filter-type]").each(function(){var u=i.attach($(this),t);s.push(u)});_.each(s,function(u){if(u.init){u.init()}});t.retrieve()})},attachAllNone:function(r){var s=this;$(r).on("click","[data-filter-select=all]",function(u){var t=$(this).parents("[data-filter-group=true]");t.find('input[type="checkbox"]').prop("checked",true);s.rebuild(true);if(u.preventDefault){u.preventDefault()}return false});$(r).on("click","[data-filter-select=none]",function(u){var t=$(this).parents("[data-filter-group=true]");t.find('input[type="checkbox"]').prop("checked",false);s.rebuild(true);if(u.preventDefault){u.preventDefault()}return false})},getFunction:function(){if(!this.filterFunction){this.rebuildImmediate()}return this.filterFunction},rebuildImmediate:function(r){var t=this,u=this.conditions;_.map(this.types,function(v){v.rebuild()});_.each(u,function(v){v.check()});_.map(this.types,function(v){v.rebuild()});var s;if(this.types.search.search){s=[this.types.search.getTestFunction(t)]}else{s=_.map(this.types,function(v){return v.getTestFunction(t)})}this.filterFunction=function(v){return _.every(s,function(w){return w(v)})};if(this.apply){this.apply()}if(r){this.store()}},rebuild:function(r){this.rebuildImmediate(r)},getMigratedFilters:function(){var v=this.filterMigrations,x=k.get(p,{}),s=x.data,y=x.version,u=k.get("FD.lobby.filter"),r=window.Cookie.get("lobbyFilter"),t,z,w;if(y===q){return s}else{if(!y){if(u){y=0;s=u}else{if(r){y=-1;s=r}else{return}}}}z=s;if(y<q){w={constant:1,direction:"up",test:function(){return t<q},step:function(){++t}}}else{w={constant:0,direction:"down",test:function(){return t>q},step:function(){--t}}}for(t=y;w.test();w.step()){z=v[t+w.constant][w.direction](_.clone(z))}k.set(p,{data:z,version:q});return z},filterMigrations:[{up:function(s){var r={filter:{},elements:{}},u=r.filter,t=function(v){return !(v===undefined||v===null)};if(!t(s)){return r}if(t(s.entryMax)&&t(s.entryMin)){u.entryFee=[{index:s.entryMin,state:true},{index:s.entryMax+1,state:false}]}if(t(s.startTime)){u.start=s.startTime}if(t(s.userCreated)){u.userCreated=s.userCreated?"true":false}return r},down:function(r){}},{up:function(r){var s=r.filter=_.clone(r.filter);s.sport={all:true,cbb:false,cfb:false,mlb:false,nba:false,nfl:false,nhl:false};s.size=[{index:0,state:true},{index:2147483648,state:false}];return r},down:function(r){}}],retrieve:function(){var r=this.getMigratedFilters();if(!r||!r.filter){return}_.each(this.types,function(t,s){if(r.filter[s]){t.unpack(r.filter[s])}});_.each(this.persist,function(s){if(r.elements[s.name]){s.unpack(r.elements[s.name])}});this.rebuild()},store:function(){var r={filter:{},elements:{}};_.each(this.types,function(t,s){r.filter[s]=t.pack()});_.each(this.persist,function(s){r.elements[s.name]=s.pack()});k.set(p,{data:r,version:q})},filter:function(r){this.prepare(r);var s=this.getFunction();return _.filter(r,s)},prepare:function(t){var w=parseInt(new Date().getTime()*0.001,10),v=this.types.sport.def.values,x=_.object(v,_.times(v.length,function(){return -1}));_.each(t,function(y){var A=y.get("startTime"),z=y.get("sport");if(A<=w){return}if(x[z]==-1||A<x[z]){x[z]=A}});this.startTimes=x;var s=new Date();s.setHours(23);s.setMinutes(59);s.setSeconds(59);s.setMilliseconds(999);s=parseInt(s.getTime()*0.001,10);var r=s+2;for(var u=0;u<t.length;u++){r=Math.min(t[u].get("startTime"),r)}if(r>s){s=new Date(s+2*1000);s.setHours(23);s.setMinutes(59);s.setSeconds(59);s.setMilliseconds(999);s=parseInt(s.getTime()*0.001,10)}this.todayEnd=s}};(function(){function s(B,A){var C=A.lookup;return function(D){if(C.all){return true}else{return A.lookup[D.get("sport")]}}}function w(B,A){switch(A.selected){case"today":return function(C){return C.get("startTime")<=B.todayEnd};case"next":return function(C){return C.get("startTime")<=B.startTimes[C.get("sport")]};default:return function(C){return true}}}function t(C,B){var A=B.selected;return function(E){var D=E.get("flags");if(D.user){return A}return true}}function u(B,A){var C=A.lookup;return function(E){if(C.all){return true}var D=E.get("flags");if(C.tournament){return D.tournament}else{if(C.league){return !D.tournament&&!D["50_50"]&&(+E.get("size")!==2)}else{if(D["50_50"]&&!C["5050"]){return false}if(E.get("size")==2){if(!C.headtohead){return false}}else{if(!C.league&&!D["50_50"]){return false}}}}return true}}function y(C,B){var A=B.search.toLowerCase();if(!A||A===""){return function(D){return true}}return function(D){if(D.get("title").toLowerCase().indexOf(A)!==-1){return true}var E=D.get("entriesData");if(E&&(typeof E[0]==="string")){return E[0].toLowerCase().indexOf(A)!==-1}return false}}var z=o.Set,v=o.Range,r=o.Switch,x=o.TextSearch;c.TYPES={sport:new z("sport",["all","nfl","mlb","nba","nhl","cfb","cbb"],false,s),size:new v("size","-"),entryFee:new v("entryFee","-"),userCreated:new r("usercreated",[true,false],false,t),start:new r("start",["next","today","all"],"all",w),type:new z("type",["all","headtohead","tournament","league","5050"],false,u),search:new x("title,entries","",y)}})();c.attach=function(s,r){return new c(s,c.TYPES,r)};m.Lobby.Filter=c;m.Lobby.Ranges=f})(this);(function(){Lobby.NextGameTimer=function(f){function e(){var h=f.getVisibleItems();var i=parseInt(new Date().getTime()*0.001,10);var j=-1;_(h).map(function(l){var k=l.get("startTime");if((j===-1&&k>i)||(k>i&&(k<j))){j=k}});return j}var c=f.$el.closest("div.lobby");var d=e(),a=parseInt(new Date().getTime()*0.001,10);var b=$('<div class="nextgame"><span class="next-game-label">Next contest starts in:</span><span class="value"></span></div>');var g=new CountdownPlain(b.find("span.value"),d-a,function(){b.find("span.value").text("")},CountdownPlain.Short);c.find("div.title a.create-contest").after(b);this.update=function(){if(e()===-1){b.hide()}else{b.show()}g.setTime(e()-parseInt(new Date().getTime()*0.001,10))}}})();window.RangeDropdown=function(f,c,g){var k=f.get(0).options;var i=k.length-1;var a=$("<div class='dropdown'></div>");var d=f.clone();var j=f.clone();var b=d.get(0);var h=j.get(0);d.show();j.show();d.val(k[0].value);j.val(k[i].value);a.append("Min:",d,"Max:",j);function e(){var n=b.options[b.selectedIndex];var l=h.options[h.selectedIndex];if(parseInt(n.value,10)>parseInt(l.value,10)){var m=n;n=l;l=m}c(n,l);g(n,l)}f.after(a);d.change(e);j.change(e);this.setValues=function(m,l){d.val(m);j.val(l)}};function RangeSlider(b,x,s){if($("#mobileMenuBar").length){return new RangeDropdown(b,x,s)}var d=b.get(0).options;var z=d.length-1;var v=[];var g=$('<div class="rangeslider">');var w=$('<div class="background">');var u=[$('<div class="knob left">'),$('<div class="knob right">')];var q=$('<div class="range">');var h=[0,z];var c=$('<div class="label right">'+$(d[z]).text()+"</div>");var A=$('<div class="label left">'+$(d[0]).text()+"</div>");g.append(w);g.append(u[0],u[1]);g.append(c,A);w.append(q);b.after(g);t();var p={"margin-top":-w.outerHeight()+"px"};u[0].css(p);u[1].css(p);function y(C,F){var D=C.closest(":visible").children(),E;D.addClass("temp-show");var B=F();D.removeClass("temp-show");return B}var r,a;y(w,function(){r=w.innerWidth();a=u[0].innerWidth()});var i=r/d.length;var k=a>>1;var m=i*0.5;var o=0;for(var f=0;f<r;f+=i){var j=$('<div class="marker">');var e=parseInt(f);v.push(e);j.css({"margin-left":(e+k-o-2)+"px"});o=e+k;w.append(j)}l(0,h[0]);l(1,h[1]);x(d[h[0]],d[h[1]]);n();function n(){var C=h[0]*i+k;var B=h[1]*i+k;q.css({"margin-left":C+"px",width:(B-C)+"px"})}function l(D,C,F){if(!F){F=0}if(C>=v.length){C=Math.max(0,v.length-1)}var E=v[C]+parseInt(F);u[D].css({"margin-left":E+"px"});var B=h[D];h[D]=C;n();h[D]=B}this.setIndices=function(C,B){l(0,C);l(1,B);n()};this.setValues=function(F,B){var E=d[0].value,D=d[d.length-1].value;F=Math.max(F,E);B=Math.min(B,D);for(var C=0;C<d.length;C++){if(F==d[C].value){h[0]=C;l(0,C)}if(B==d[C].value){h[1]=C;l(1,C)}}n();if(x){x(d[h[0]],d[h[1]])}};function t(){var H=-1,F,I;var E=0,C=0;$(document).mousemove(function(K){if(H==-1){return}var L=K.pageX-w.offset().left+m-k;L=Math.min(C,Math.max(E,L));var J=parseInt(L/i);var M=parseInt(L-k-(I*i));l(H,I,Math.max(-m,Math.min(m,M*0.25)));if(J!=I){I=J;if(x){if(H==0){x(d[J],d[h[1]])}else{x(d[h[0]],d[J])}}}});function B(){if(s){n();s(d[h[0]],d[h[1]])}}function D(Q){function L(T){var S=T<0?-1:(T>0?1:0);return S}var N=Q.pageX-w.offset().left-k;var P=parseInt((N+m)/i);var O=(Math.abs(N-h[0]*i));var M=(Math.abs(N-h[1]*i));var K={slider:-1,min:0,max:0,dir:0};function J(S){K.slider=S;if(S==0){K.min=0;K.max=h[1];K.dir=L(P-h[0])}else{K.min=h[0];K.max=z;K.dir=L(P-h[1])}}function R(){var S=h[K.slider]+K.dir;if(S<K.min){return false}else{if(S>K.max){return false}}h[K.slider]=S;l(K.slider,S);B();return true}if((O>0&&O<M)||M==0){J(0)}else{J(1)}if(!R()){J(1-K.slider);R()}}w.click(D);u[0].click(D);u[1].click(D);q.click(D);$(document).mouseup(function(){if(H==-1){return}l(H,I);if(F==I){H=-1;return}h[H]=I;H=-1;if(h[0]==h[1]){if(h[0]==0){u[0].after(u[1])}else{if(h[0]==z){u[1].after(u[0])}}}B()});function G(K,L,J){H=K;E=L*i+k;C=J*i;F=I=h[H]}u[0].mousedown(function(J){G(0,0,h[1]);if(J.preventDefault){J.preventDefault()}return false});u[1].mousedown(function(J){G(1,h[0],z);if(J.preventDefault){J.preventDefault()}return false})}}Lobby.UpdateControl=function(e,c){var a=$('<div class="autoupdate"></div>');var d=$('<button class="button">Refresh Lobby</button>');LobbyConnection.PAUSED=true;e.$element.prepend(a);var b=a.find("input");a.append(d);a.append("<p>Automatic lobby updates are currently experiencing performance issues in Internet Explorer and have therefore been disabled. You can click the 'Refresh Lobby' button to manually update, until we have fixed the problem.</p>");d.click(function(){c()});b.change(function(){var f=b.prop("checked")?true:false;if(f){LobbyConnection.PAUSED=false;d.hide()}else{LobbyConnection.PAUSED=true;d.show()}})};