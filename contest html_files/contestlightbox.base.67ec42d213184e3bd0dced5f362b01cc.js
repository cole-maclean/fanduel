var ContestLightbox={};(function(b){var a=["nba_official_tentpole"];ContestLightbox.Model=b.Model.extend({defaults:{eligibleRosters:[],userEntryTotal:0,disabled:false,tab:"entries",allowQuickfire:false},initialize:function(){this.setEligibleRosters();this.setUserEntryTotal();this.updateSize();this.updateEntryCount();this.updateFlags();this.updateTitle();this.listenTo(this,"change:size",this.updateSize);this.listenTo(this,"change:size",this.updateEntryCount);this.listenTo(this,"change:entriesData",this.updateEntryCount);this.listenTo(this,"change:flags",this.updateFlags);this.listenTo(this,"change:title",this.updateTitle);this.listenTo(this,"change:seatCode",this.enable)},setEligibleRosters:function(){this.set("eligibleRosters",FD.rosterData.getEligibleRosters(this.get("gameId")))},setUserEntryTotal:function(){this.set("userEntryTotal",FD.rosterData.getTotalEntriesCount(this.get("seatCode")||this.get("uniqueId")))},enable:function(){this.setUserEntryTotal();this.set("disabled",false)},updateSize:function(){this.attributes.size=parseInt(this.attributes.size,10)},updateEntryCount:function(){var c=this.get("size");var d=this.get("entriesData");this.set({entryCount:c==2?1.5:parseInt(d,10)},{silent:true})},updateFlags:function(){var d=this.get("flags");var c=_.intersection(_.keys(d),a).length>0;this.set({allowQuickfire:(this.get("eligibleRosters").length>0)&&!c})},updateTitle:function(){var c;if(+this.get("size")===2){c="H2H vs. "+this.get("entriesData")[0]}else{c=this.get("title")}this.set("sortTitle",this.get("sport")+" "+c)}})})(Backbone);(function(a,d,f,e,c,b){e.View=function(i){var h,l,n,g=i.isFromLobby;if(i.isFromLobby){l=i.lobbyView.$el;n=function(p){var o=p.closest("tr").data("lazyView");if(!o){return false}return o.model}}else{if(i.isFromDraft){l=i.$viewElement;n=function(){return i.model}}}l.on("click","[data-tab]",function(s){var p=d(s.target);h=n(p);var r=p.data("lightbox");var q=a.template(d("#Contest-Lightbox").html());h.set("tab",d(this).attr("data-tab"));if(!h.get("flags").multi&&h.get("userEntryTotal")>0){if(h.get("size")!==2){h.set("disabled",true);j(h)}}else{h.set("disabled",false)}if(!r){var o=a.extend({},h.attributes,{isFromLobby:g});p.data("lightbox",r=f.createFromHTML(h.get("title"),q(o),null,"quickfire-lightbox"))}r.show();j(h);d(".quickfire-lightbox [data-tab]").removeClass("is-active");d('.lightbox [data-tab="'+h.get("tab")+'"]').addClass("is-active");m(h);d(".quickfire-lightbox").on("click","[data-tab]",function(t){if(d(this).hasClass("is-active")){return}d(".quickfire-lightbox [data-tab]").removeClass("is-active");d(this).addClass("is-active");h.set("tab",d(this).attr("data-tab"));m(h);return false});return false});function k(y,s){var t=0;var z=45;var u=0;var o;var v=s.get("entryCount");var x=a.template(d("#Contest-Lightbox-Entries").html());function q(){o=Math.ceil(v/z)-1}q();function p(){var B=y;var A=new c(u,o,function(C){u=C;t=u*z;w()});B.find("div.pager").remove();if(o>=1){B.find("div.entries").append(A)}}var w=this.show=function(){if(s.get("stack")||s.get("isHeadToHead")){var A={position:t,size:z,entries:[{position:"1",userHTML:'<a target="_blank" href="/users/'+s.get("entriesData")[0]+'">'+s.get("entriesData")[0]+"</a>"}]};y.html(x(A));p();return}d.ajax({url:"/pg/Lobby/showTableEntriesJSON/"+s.get("uniqueId")+"/"+t+"/"+z,dataType:"json"}).done(function(B){B.page=u;B.position=t;B.size=z;y.html(x(B));p()})};function r(){q()}s.bind("change",r)}function m(r){var t=r.get("tab");var s=d("#quickfire-tab-"+t);var u=d("#Contest-Lightbox-Loading").html();var q;d(".quickfire-tab").removeClass("is-active");s.addClass("is-active").html(u);switch(t){case"info":var p=a.template(d("#Contest-Lightbox-Info").html());d.ajax({url:"/pg/Lobby/showGameInfoJSON/"+r.get("gameId"),dataType:"json"}).done(function(v){r.attributes.contest=v;s.html(p(r.attributes))});break;case"entries":q=new k(s,r);q.show();break;case"prizes":d.ajax({url:"/pg/Lobby/showGroupedPrizeBreakdown/"+r.get("tableSpecId"),dataType:"html"}).done(function(v){s.html(v)});break;case"quickfire":var o=a.template(d("#Contest-Lightbox-Quickfire").html());a.each(r.attributes.eligibleRosters,function(v){v.errorMessage=""});s.html(o(r.attributes));s.off("click",".quickfire-enter button");s.on("click",".quickfire-enter button",function(){var z=d(this);var y=z.attr("data-rosterId");var v=z.parent("form");var x=d("#balance");var w=z.parents(".quickfire-lineup").index();z.addClass("button-is-loading");v.find('[name="code"]').val(r.get("seatCode")||r.get("uniqueId"));d.ajax({type:"POST",url:v.attr("action"),data:v.serialize()}).done(function(A){if(!A.messages){return}if(A.messages.success){b.rosterData.addEntry(y,r.get("seatCode")||r.get("uniqueId"));r.setEligibleRosters();r.setUserEntryTotal();x.text(A.balance);if(r.get("size")===2&&r.get("userEntryTotal")>0){r.set("disabled",true)}}if(A.messages.warning){r.attributes.eligibleRosters[w].errorMessage=A.messages.warning;r.set("disabled",true)}}).fail(function(A){r.attributes.eligibleRosters[w].errorMessage="There was a problem submitting your lineup.";r.set("disabled",true)}).always(function(A){z.removeClass("button-is-loading");s.html(o(r.attributes));j(r)});return false});break;default:break}}function j(o){if(g){var p=a.template(d("#Contest-Lightbox-Quickfire-Footer").html());d(".quickfire-footer").html(p(o.attributes))}}}})(_,jQuery,Lightbox,ContestLightbox,Pager,FD);